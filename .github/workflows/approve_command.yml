name: 'Approve Slash Command'

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version Number (eg. v1.1.0)'
        required: true

jobs:
  indicate_start:
    if: ${{ github.event.inputs.version }} == /^v\d+\.\d+\.\d+/
    runs-on: ubuntu-latest
    steps:
      - name: 'Add reaction to approve command'
        uses: peter-evans/create-or-update-comment@v1
        with:
          token: ${{ secrets.GH_ACTIONS_PAT }}
          repository: ${{ github.event.client_payload.github.payload.repository.full_name }}
          comment-id: ${{ github.event.client_payload.github.payload.comment.id }}
          reaction-type: rocket
  run_prs:
    if: ${{ github.event.inputs.version }} == /^v\d+\.\d+\.\d+/
    uses: department-of-veterans-affairs/va-mobile-app/.github/workflows/test.yml@slash-command
    with:
      version: ${{github.event.inputs.version}} #${{ github.event.client_payload.slash_command.args.unnamed.arg1 }}
  comment_complete:
    if: ${{ github.event.inputs.version }} == /^v\d+\.\d+\.\d+/
    runs-on: ubuntu-latest
    needs: run_prs
    steps:
      - name: 'Checkout repo'
        uses: actions/checkout@v2
      - name: 'Set up GH CLI secret'
        run: echo "${{ secrets.GITHUB_TOKEN }}" >> token.txt
      - name: 'Log into GH CLI'
        run: gh auth login --with-token < token.txt
      - name: 'test reuse envs come through'
        run: |
          gh issue comment ${{ github.event.client_payload.github.payload.issue.number }} -b "PRs Successfully Created! :raised_hands:
          [PR to develop](${{needs.run_prs.outputs.devPrUrl}})
          [PR to master](${{needs.run_prs.outputs.releasePrUrl}})"
