name: "Create Release Branch Ticket"

on:
  push:
    branches:
      - integrate-testrail-automation
jobs:
  test_rails:
    uses: department-of-veterans-affairs/va-mobile-app/.github/workflows/start_test_rail_run.yml@integrate-testrail-automation
    with:
      version: ${{ github.event.client_payload.slash_command.args.unnamed.arg1 }}
      releaseDate: "06/22/2022"
      ticketNumber: "3315"
    secrets:
      TEST_RAIL_USER: ${{secrets.TEST_RAIL_USER}}
      TEST_RAIL_KEY: ${{secrets.TEST_RAIL_KEY}}
  update_ticket:
    runs-on: ubuntu-latest
    needs: [ test_rails, release_ticket ]
    steps:
      - run: echo "${{ secrets.GITHUB_TOKEN }}" >> token.txt
      - run: gh auth login --with-token < token.txt
      - run: gh issue comment 3315} -b "[RC Testrail Pass](${{needs.test_rails.outputs.testrailUrl}})"
