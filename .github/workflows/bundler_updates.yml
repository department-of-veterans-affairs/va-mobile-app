name: "Update Bundler"

on:
  schedule:
    - cron: "0 7 * * 3"
  push:
    branches:
      - feature/bundler-auto-updates
jobs:
  update_bundler:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout repo'
        uses: actions/checkout@v3
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.1'
      - name: 'Run update script for android files'
        run: |
          bundle update --all
          bundle exec fastlane update_plugins
        working-directory: VAMobile/android/
      - name: 'Run update script for ios files'
        run: |
          bundle update --all
          bundle exec fastlane update_plugins
        working-directory: VAMobile/ios/
      - name: 'Set git status flag'
        id: git_status
        run: |
          if [[ -n $(git status --porcelain --untracked-files=no) ]]
          then
            echo 'There are changes in git'
            git status --porcelain
            git config --global user.name 'VA Automation Bot'
            git config --global user.email 'va-mobileapp@adhocteam.us'
            git add -A
            git commit -m "Automated bundler and fastlane updates"
            git push -u origin feature/bundler-auto-updates
          else
            echo 'There are no changes to the lock files or plugins'
          fi

