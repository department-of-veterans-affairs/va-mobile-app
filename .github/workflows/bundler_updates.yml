name: "Update Bundler"

on:
  schedule:
    - cron: "0 7 * * 3"
  push:
    branches:
      - feature/bundler-auto-updates
jobs:
  update_bundler:
    runs-on: ubuntu-latest
    outputs:
      clean: ${{steps.git_status.outputs.clean}}
    steps:
      - name: 'Checkout repo'
        uses: actions/checkout@v2
      - name: 'Run update script for android files'
        run: |
          bundle update --all
          bundle exec fastlane update_plugins
        working-directory: VAMobile/android/
      - name: 'Run update script for ios files'
        run: |
          bundle update --all
          bundle exec fastlane update_plugins
        working-directory: VAMobile/ios/
      - name: 'Set git status flag'
        id: git_status
        run: if [[ -n $(git status --porcelain --untracked-files=no) ]]; then echo "::set-output name=clean::false"; else echo "::set-output name=clean::true"; fi;
  commit_changes:
    runs-on: ubuntu-latest
    needs: update_bundler
    if: ${{needs.update_bundler.outputs.clean == 'false' }}
    steps:
      - run: echo 'There are changes in git'
      - run: git status --porcelain

