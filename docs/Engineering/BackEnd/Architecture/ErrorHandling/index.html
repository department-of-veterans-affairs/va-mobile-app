<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Engineering/BackEnd/Architecture/ErrorHandling" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Error Handling | VA: Health and Benefits app documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://department-of-veterans-affairs.github.io/va-mobile-app/docs/Engineering/BackEnd/Architecture/ErrorHandling"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Error Handling | VA: Health and Benefits app documentation"><meta data-rh="true" name="description" content="The request lifecycle"><meta data-rh="true" property="og:description" content="The request lifecycle"><link data-rh="true" rel="icon" href="/va-mobile-app/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://department-of-veterans-affairs.github.io/va-mobile-app/docs/Engineering/BackEnd/Architecture/ErrorHandling"><link data-rh="true" rel="alternate" href="https://department-of-veterans-affairs.github.io/va-mobile-app/docs/Engineering/BackEnd/Architecture/ErrorHandling" hreflang="en"><link data-rh="true" rel="alternate" href="https://department-of-veterans-affairs.github.io/va-mobile-app/docs/Engineering/BackEnd/Architecture/ErrorHandling" hreflang="x-default"><link rel="stylesheet" href="/va-mobile-app/assets/css/styles.603b9829.css">
<script src="/va-mobile-app/assets/js/runtime~main.dd12bc19.js" defer="defer"></script>
<script src="/va-mobile-app/assets/js/main.031e6e5c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/va-mobile-app/img/va-logo.png"><link rel="preload" as="image" href="/va-mobile-app/img/va-blue-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/va-mobile-app/"><div class="navbar__logo"><img src="/va-mobile-app/img/va-logo.png" alt="VA Mobile logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/va-mobile-app/img/va-logo.png" alt="VA Mobile logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">VA Mobile Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/va-mobile-app/docs/Intro">Documentation</a><a class="navbar__item navbar__link" href="/va-mobile-app/design/Intro">Design System</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/department-of-veterans-affairs/va-mobile-app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/va-mobile-app/docs/Intro">Intro to the VA Mobile App</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/docs/Contributing/">Contributing</a><button aria-label="Expand sidebar category &#x27;Contributing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/va-mobile-app/docs/Flagship design library/Content/content-style-guide">Flagship design library</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/docs/Product/">Product</a><button aria-label="Expand sidebar category &#x27;Product&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/va-mobile-app/docs/Engineering/">Engineering</a><button aria-label="Collapse sidebar category &#x27;Engineering&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/">Back End</a><button aria-label="Collapse sidebar category &#x27;Back End&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/API/">API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/AddressUpdateFlow">Architecture</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/AddressUpdateFlow">Address Update Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/Auth Diagrams">Authentication Diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/BackgroundWorkersAndCaching">Background Workers and Caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/ContinuousIntegrationAndDeployment">Continuous Integration and Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/Devops">Devops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/DirectoryLayout">Directory Layout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/Endpoint Creation Checklist">Endpoint Creation Checklist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/ErrorHandling">Error Handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/FeatureFlagging">Feature Flagging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/JSONAPI">JSON API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/ModelsAndSerializers">Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/OpenAPIDocumentation">OpenAPI Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/ParallelCalls">Parallel Calls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/RecordFiltering">Record Filtering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/Services">Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/sis">SIS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Features/CustomErrorResponses">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Monitoring/DataDog">Monitoring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/va-mobile-app/docs/Engineering/BackEnd/Testing/">Testing</a><button aria-label="Expand sidebar category &#x27;Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/va-mobile-app/docs/Engineering/FrontEnd/">Front End</a><button aria-label="Expand sidebar category &#x27;Front End&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/va-mobile-app/docs/Engineering/DevOps/AutomationCodeDocs/GitHubActions/Overview">DevOps</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/docs/UX/">UX</a><button aria-label="Expand sidebar category &#x27;UX&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/docs/QA/">QA</a><button aria-label="Expand sidebar category &#x27;QA&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/docs/Operations/">Operations</a><button aria-label="Expand sidebar category &#x27;Operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/docs/About our team/">About our team</a><button aria-label="Expand sidebar category &#x27;About our team&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/va-mobile-app/docs/App Features/Availability Framework/">App Features</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/va-mobile-app/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/va-mobile-app/docs/Engineering/"><span itemprop="name">Engineering</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/va-mobile-app/docs/Engineering/BackEnd/"><span itemprop="name">Back End</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Error Handling</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Error Handling</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-request-lifecycle">The request lifecycle<a href="#the-request-lifecycle" class="hash-link" aria-label="Direct link to The request lifecycle" title="Direct link to The request lifecycle">​</a></h2>
<p>The vets-api mobile endpoints generally follow the following pattern:</p>
<ul>
<li>request is received and routed to the controller</li>
<li>the controller verifies the validity of the user&#x27;s bearer token</li>
<li>the controller runs any other necessary validations, such as confirming the user has access to the content and that any provided parameters are valid</li>
<li>the controller then uses <a href="#outbound-request-service-objects">service objects</a> to communicate with other servers in the vets-api ecosystem. those service objects may perform their own validations. These will generally be the same as the ones performed in the controller but may occasionally differ.</li>
<li>the external service processes that request and responds or times out</li>
<li>the service object processes the response.</li>
<li>when the request fails (status is &gt;= 400), the service objects will raise corresponding errors. These errors are rescued by <a href="#exception-handling">ExceptionHandling</a> and responds with error details to the client. (Note: this is only true if the service configuration uses the Faraday plug <code>faraday.use Faraday::Response::RaiseError</code>. Most services that make requests for data do use this plug.)</li>
<li>when the request is successful (status is &lt; 400), any additional business logic will be applied by the service object. This often includes parsing and converting the data to models.</li>
<li>the data is then returned to the controller.</li>
<li>the controller then performs any additional modifications that are necessary, serializes the data, and returns it to the client with an appropriate status code.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="outbound-request-service-objects">Outbound Request Service Objects<a href="#outbound-request-service-objects" class="hash-link" aria-label="Direct link to Outbound Request Service Objects" title="Direct link to Outbound Request Service Objects">​</a></h2>
<p>The mobile controllers use a variety of service objects to communicate with upstream servers. These are typically written by other teams and are not under the control of the mobile team. The service objects provide a common interface for establishing connections using Faraday (a ruby library for making network requests) and making requests to external services. They consist of two parts:</p>
<ol>
<li>
<p>the configuration. The configuration must be a subclass of <code>Common::Client::Configuration::Base</code>. The configuration is primarily responsible for setting values necessary for connecting to the upstream server–such as base URLs and api keys–and for establishing that connection via the <code>connection</code> method. In addition to determining which URLs, headers, and options to use when connecting to the upstream server, the <code>connection</code> method also adds a variety of middleware plugs that determine how requests and responses are processed by Faraday. Some of these plugs are very simple built-ins, such as the json plug used to process json responses and the snakecase plug used to specify that the response keys will be in snakecase format. Other plugs are custom-written within the vets-api. These plugs are all types of Faraday middleware that have the ability to modify the outbound request or process the inbound response. These plugs can raise errors. For example, if the configuration specifies a json plug but the response is not parsable json, it will raise an error.</p>
</li>
<li>
<p>the service itself. These are subclasses of <code>Common::Client::Base</code>. The service object is responsible for using the connection created by the configuration to make upstream requests and for processing the responses. These service objects sometimes include user access checks and request data validity checks, which can raise errors. They often process the response by modifying status codes and by adapting data to models. They also provide some default error handling in the <code>request</code> method that rescues some common errors that can arise during the request and converts them into <a href="#error-classes">errors that are defined within the vets-api</a>.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="upstream-servers">Upstream Servers<a href="#upstream-servers" class="hash-link" aria-label="Direct link to Upstream Servers" title="Direct link to Upstream Servers">​</a></h2>
<p>Nearly all data returned from the vets-api comes from external servers within the VA digital ecosystem. Some of the endpoints we consume are not well documented. As a result, it&#x27;s sometimes impossible to fully know what response statuses and bodies to expect from these servers. We are usually able to find out most of this information by talking to the product owners of these APIs or by testing the API ourselves, but we don&#x27;t always receive an exhaustive list and often aren&#x27;t told what all of the errors mean. These services can also change without our knowledge because they are still under active development. As a result, these external services can be a bit of a black box. Thankfully, this is improving with newer APIs, such as those provided by lighthouse, which are now being documented as part of the development process.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-classes">Error Classes<a href="#error-classes" class="hash-link" aria-label="Direct link to Error Classes" title="Direct link to Error Classes">​</a></h2>
<p>All errors in the vets-api will ultimately be subclasses of <code>Common::Exceptions::BaseError</code>, either because they were explicitly raised within the vets-api or because they were converted to known error classes within the mobile app module, the <a href="#outbound-request-service-objects">service object</a>, or <a href="#exception-handling">Exception Handling</a>. This is useful for providing a common interface for errors, which allows error classes to define their own response statuses, messages, and logging behavior.</p>
<p>The error classes work in coordination with values set in config/locales/exceptions.en.yml. The error classes implement an <code>i18n_key</code> method that matches an entry in that yaml file that can include additional error details, such as messages and statuses, that can be used by ExceptionHandling.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exception-handling">Exception Handling<a href="#exception-handling" class="hash-link" aria-label="Direct link to Exception Handling" title="Direct link to Exception Handling">​</a></h2>
<p>All controllers in the vets-api mobile backend include the <code>ExceptionHandling</code> module, which catches any errors that arise during a request, remaps any unknown errors to <a href="#error-classes">known errors</a>, then renders the error to the user with the status code and details defined in the error class. Any errors that are not otherwise explicitly handled will be mapped to <code>Common::Exceptions::InternalServerError</code> and will return 500 to the client.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="coupling-between-service-objects-exception-handling-and-error-classes">Coupling between Service Objects, Exception Handling, and Error Classes<a href="#coupling-between-service-objects-exception-handling-and-error-classes" class="hash-link" aria-label="Direct link to Coupling between Service Objects, Exception Handling, and Error Classes" title="Direct link to Coupling between Service Objects, Exception Handling, and Error Classes">​</a></h2>
<p>The service objects need ExceptionHandling to handle its errors. ExceptionHandling needs errors to be subclasses of <code>BaseError</code> because it relies on methods in <code>BaseError</code> to respond to the client with the appropriate information. These three components are coupled.</p>
<p>This coupling provides a great deal of value. It prevents us from recreating the error handling wheel with every new endpoint. Without it, each controller would have to have explicit handling for each potential error case. But it also comes at a cost. That cost is that it&#x27;s difficult to know exactly which errors the controller can return because to know that you have to know which errors the upstream can return, which errors the service object can produce, and how those errors can be modified by the service object, error class, and ExceptionHandling.</p>
<p>It also makes it difficult to fully test service object code in isolation, which makes it important to write thorough integration tests because ExceptionHandling can call methods on error classes that might not be called in service object unit tests. Bugs can exist in service objects and even within error classes that will not be revealed without integration testing with the ExceptionHandling class.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrapup">Wrapup<a href="#wrapup" class="hash-link" aria-label="Direct link to Wrapup" title="Direct link to Wrapup">​</a></h2>
<p>Errors can arise during any portion of the <a href="#the-request-lifecycle">request lifestyle</a>. Errors that arise in the mobile portion of the vets-api are generally predictable. For example, we know that failure to authenticate the user will result in a 401, failure to authorize the user to access the resource will result in a 403, and a syntax error within the code itself will result in a 500.</p>
<p>Once we leave the mobile backend, the possible errors become more difficult fully know due code complexity and coupling between our service objects, errors, and ExceptionHandling. Code outside of the mobile backend can also be changed without our knowledge, potentially removing, changing, or introducing errors.</p>
<p>Once we make a request to an external service, the errors become even less predictable, due to a combination of poor documentation, poor interteam communication, and ongoing changes being made to the upstream code.</p>
<p>As a result, errors may at times be possible that aren&#x27;t listed in our api documentation. But much as the vets-api has ExceptionHandling to ensure that all errors encountered in the vets-api will be handled gracefully even if we don&#x27;t know anything about that error, the mobile app has built-in error handling for common cases like 401 and 403 but also handles any unknown 400+ status codes so there should be no inherent problem with an occasional unexpected error.</p>
<p>While it may not be possible to know every possible error that can occur, what is more important is that we document any errors that change behavior in the mobile app so the mobile app can be coded to handle those cases appropriately. For example, a few endpoints can return 207 with detailed messages when only partial data was received. This must be communicated to the user, so coordination is needed between frontend, backend, and product to ensure a smooth user experience. Given the inherent unknowns of the VA digital services ecosystem, fault tolerance is a critical feature of the VA mobile app.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/Endpoint Creation Checklist"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Endpoint Creation Checklist</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/va-mobile-app/docs/Engineering/BackEnd/Architecture/FeatureFlagging"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Feature Flagging</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-request-lifecycle" class="table-of-contents__link toc-highlight">The request lifecycle</a></li><li><a href="#outbound-request-service-objects" class="table-of-contents__link toc-highlight">Outbound Request Service Objects</a></li><li><a href="#upstream-servers" class="table-of-contents__link toc-highlight">Upstream Servers</a></li><li><a href="#error-classes" class="table-of-contents__link toc-highlight">Error Classes</a></li><li><a href="#exception-handling" class="table-of-contents__link toc-highlight">Exception Handling</a></li><li><a href="#coupling-between-service-objects-exception-handling-and-error-classes" class="table-of-contents__link toc-highlight">Coupling between Service Objects, Exception Handling, and Error Classes</a></li><li><a href="#wrapup" class="table-of-contents__link toc-highlight">Wrapup</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/va-mobile-app/docs/Intro">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/va-mobile-app/design/Intro">Design System</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/va-mobile-app/img/va-blue-logo.png" alt="VA, United States Department of Veteran Affairs" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/va-mobile-app/img/va-blue-logo.png" alt="VA, United States Department of Veteran Affairs" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2025 VA Mobile App, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>