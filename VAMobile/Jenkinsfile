// Jenkinsfile (Declarative Pipeline)

// This variable holds the path to your mobile app repository on the Mac mini.
// You will need to change this to the actual path.
def repoPath = 'Users/oddball/repos/va-mobile-app/VAMobile'

pipeline {
    // This 'agent' block tells Jenkins to run the entire pipeline on a node
    // with the label "mac-mini".
    agent {
        label 'MacMini'
    }

    // You can use the 'tools' directive to automatically install Node.js and Yarn
    // if you have them configured in Jenkins. This is a good practice.
    // Replace 'node-18' with the name of your Node.js installation.
    // If not configured, ensure Node.js and Yarn are in the system PATH on the Mac mini.
    tools {
        nodejs 'node-22'
    }

    stages {
        stage('Update Repository') {
            steps {
                // The 'dir' step changes the working directory to the specified path.
                // All commands within this block will be executed there.
                dir(repoPath) {
                    // Update the repository with the latest changes from the remote.
                    // This assumes the Mac mini has access to the Git remote.
                    sh 'git pull'
                }
            }
        }
    }
}

        // stage('Install Dependencies and Build') {
        //     steps {
        //         dir(repoPath) {
        //             // Clean install to ensure all dependencies are up to date.
        //             sh 'yarn install'
        //
        //             // Trigger the mobile build. Replace 'build:mobile' with your
        //             // actual yarn script for building the mobile app.
        //             // You might have separate scripts for iOS and Android.
        //             sh 'yarn build:mobile'
        //
        //             // You might have a specific script for building iOS or Android.
        //             // For example:
        //             // sh 'yarn build:ios'
        //             // sh 'yarn build:android'
        //         }
        //     }
        // }
        //
        // stage('Run Tests (Optional)') {
        //     steps {
        //         dir(repoPath) {
        //             // Run tests after the build is complete.
        //             sh 'yarn test'
        //         }
        //     }
        // }

        // Add more stages for deploying or archiving artifacts as needed.
//         stage('Archive Build Artifacts') {
//             steps {
//                 dir(repoPath) {
//                     // This is an example of archiving build output (e.g., APKs or IPAs)
//                     // so you can download them from the Jenkins build page.
//                     // Adjust the paths to match your project's output directories.
//                     archiveArtifacts artifacts: '**/build/outputs/**/*.apk', fingerprint: true
//                     archiveArtifacts artifacts: '**/build/outputs/**/*.ipa', fingerprint: true
//                 }
//             }
//         }
//     }
// }
