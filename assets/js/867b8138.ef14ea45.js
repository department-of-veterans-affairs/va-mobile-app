"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[3128],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),d=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=d(n),m=r,h=c["".concat(o,".").concat(m)]||c[m]||u[m]||l;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=c;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<l;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},54601:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return o},default:function(){return c},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return p}});var a=n(87462),r=n(63366),l=(n(67294),n(3905)),i=["components"],s={sidebar_position:2,sidebar_label:"Commands"},o=void 0,d={unversionedId:"Engineering/DevOps/Automation Code Docs/CircleCI/Commands",id:"Engineering/DevOps/Automation Code Docs/CircleCI/Commands",title:"Commands",description:"This is a list of all the reusable commands in CircleCI, their parameters and what they do.",source:"@site/docs/Engineering/DevOps/Automation Code Docs/CircleCI/Commands.md",sourceDirName:"Engineering/DevOps/Automation Code Docs/CircleCI",slug:"/Engineering/DevOps/Automation Code Docs/CircleCI/Commands",permalink:"/va-mobile-app/docs/Engineering/DevOps/Automation Code Docs/CircleCI/Commands",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Commands"},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/va-mobile-app/docs/Engineering/DevOps/Automation Code Docs/CircleCI/Overview"},next:{title:"Jobs",permalink:"/va-mobile-app/docs/Engineering/DevOps/Automation Code Docs/CircleCI/Jobs"}},p=[{value:"<code>install_deps</code>",id:"install_deps",children:[{value:"Description",id:"description",children:[],level:3},{value:"Parameters",id:"parameters",children:[],level:3},{value:"Steps",id:"steps",children:[],level:3},{value:"Outputs",id:"outputs",children:[],level:3}],level:2},{value:"<code>install_python</code>",id:"install_python",children:[{value:"Description",id:"description-1",children:[],level:3},{value:"Parameters",id:"parameters-1",children:[],level:3},{value:"Steps",id:"steps-1",children:[],level:3},{value:"Outputs",id:"outputs-1",children:[],level:3}],level:2},{value:"<code>bundle_app</code>",id:"bundle_app",children:[{value:"Description",id:"description-2",children:[],level:3},{value:"Parameters",id:"parameters-2",children:[],level:3},{value:"Steps",id:"steps-2",children:[],level:3},{value:"Outputs",id:"outputs-2",children:[],level:3}],level:2},{value:"<code>lint</code>",id:"lint",children:[{value:"Description",id:"description-3",children:[],level:3},{value:"Parameters",id:"parameters-3",children:[],level:3},{value:"Steps",id:"steps-3",children:[],level:3},{value:"Outputs",id:"outputs-3",children:[],level:3}],level:2},{value:"<code>jest</code>",id:"jest",children:[{value:"Description",id:"description-4",children:[],level:3},{value:"Parameters",id:"parameters-4",children:[],level:3},{value:"Steps",id:"steps-4",children:[],level:3},{value:"Outputs",id:"outputs-4",children:[],level:3}],level:2},{value:"<code>install_pods</code>",id:"install_pods",children:[{value:"Description",id:"description-5",children:[],level:3},{value:"Parameters",id:"parameters-5",children:[],level:3},{value:"Steps",id:"steps-5",children:[],level:3},{value:"Outputs",id:"outputs-5",children:[],level:3}],level:2},{value:"<code>create_keys_directory</code>",id:"create_keys_directory",children:[{value:"Description",id:"description-6",children:[],level:3},{value:"Parameters",id:"parameters-6",children:[],level:3},{value:"Steps",id:"steps-6",children:[],level:3},{value:"Outputs",id:"outputs-6",children:[],level:3}],level:2},{value:"<code>decode_file</code>",id:"decode_file",children:[{value:"Description",id:"description-7",children:[],level:3},{value:"Parameters",id:"parameters-7",children:[],level:3},{value:"Steps",id:"steps-7",children:[],level:3},{value:"Outputs",id:"outputs-7",children:[],level:3}],level:2},{value:"<code>decode_ios_keys</code>",id:"decode_ios_keys",children:[{value:"Description",id:"description-8",children:[],level:3},{value:"Parameters",id:"parameters-8",children:[],level:3},{value:"Steps",id:"steps-8",children:[],level:3},{value:"Outputs",id:"outputs-8",children:[],level:3}],level:2},{value:"<code>ios_fastlane</code>",id:"ios_fastlane",children:[{value:"Description",id:"description-9",children:[],level:3},{value:"Parameters",id:"parameters-9",children:[],level:3},{value:"Steps",id:"steps-9",children:[],level:3},{value:"Outputs",id:"outputs-9",children:[],level:3}],level:2},{value:"<code>decode_android_keys</code>",id:"decode_android_keys",children:[{value:"Description",id:"description-10",children:[],level:3},{value:"Parameters",id:"parameters-10",children:[],level:3},{value:"Steps",id:"steps-10",children:[],level:3},{value:"Outputs",id:"outputs-10",children:[],level:3}],level:2},{value:"<code>android_fastlane</code>",id:"android_fastlane",children:[{value:"Description",id:"description-11",children:[],level:3},{value:"Parameters",id:"parameters-11",children:[],level:3},{value:"Steps",id:"steps-11",children:[],level:3},{value:"Outputs",id:"outputs-11",children:[],level:3}],level:2},{value:"<code>run_script</code>",id:"run_script",children:[{value:"Description",id:"description-12",children:[],level:3},{value:"Parameters",id:"parameters-12",children:[],level:3},{value:"Steps",id:"steps-12",children:[],level:3},{value:"Outputs",id:"outputs-12",children:[],level:3}],level:2},{value:"<code>get_slack_channel_id</code>",id:"get_slack_channel_id",children:[{value:"Description",id:"description-13",children:[],level:3},{value:"Parameters",id:"parameters-13",children:[],level:3},{value:"Steps",id:"steps-13",children:[],level:3},{value:"Outputs",id:"outputs-13",children:[],level:3}],level:2},{value:"<code>send_slack_message</code>",id:"send_slack_message",children:[{value:"Description",id:"description-14",children:[],level:3},{value:"Parameters",id:"parameters-14",children:[],level:3},{value:"Steps",id:"steps-14",children:[],level:3},{value:"Outputs",id:"outputs-14",children:[],level:3}],level:2},{value:"<code>persist_env</code>",id:"persist_env",children:[{value:"Description",id:"description-15",children:[],level:3},{value:"Parameters",id:"parameters-15",children:[],level:3},{value:"Steps",id:"steps-15",children:[],level:3},{value:"Outputs",id:"outputs-15",children:[],level:3}],level:2},{value:"<code>retrieve_persisted_env</code>",id:"retrieve_persisted_env",children:[{value:"Description",id:"description-16",children:[],level:3},{value:"Parameters",id:"parameters-16",children:[],level:3},{value:"Steps",id:"steps-16",children:[],level:3},{value:"Outputs",id:"outputs-16",children:[],level:3}],level:2},{value:"<code>save_slack_thread</code>",id:"save_slack_thread",children:[{value:"Description",id:"description-17",children:[],level:3},{value:"Parameters",id:"parameters-17",children:[],level:3},{value:"Steps",id:"steps-17",children:[],level:3},{value:"Outputs",id:"outputs-17",children:[],level:3}],level:2},{value:"<code>get_slack_thread</code>",id:"get_slack_thread",children:[{value:"Description",id:"description-18",children:[],level:3},{value:"Parameters",id:"parameters-18",children:[],level:3},{value:"Steps",id:"steps-18",children:[],level:3},{value:"Outputs",id:"outputs-18",children:[],level:3}],level:2},{value:"<code>queue_android_jobs</code>",id:"queue_android_jobs",children:[{value:"Description",id:"description-19",children:[],level:3},{value:"Parameters",id:"parameters-19",children:[],level:3},{value:"Steps",id:"steps-19",children:[],level:3},{value:"Outputs",id:"outputs-19",children:[],level:3}],level:2},{value:"<code>queue_ios_jobs</code>",id:"queue_ios_jobs",children:[{value:"Description",id:"description-20",children:[],level:3},{value:"Parameters",id:"parameters-20",children:[],level:3},{value:"Steps",id:"steps-20",children:[],level:3},{value:"Outputs",id:"outputs-20",children:[],level:3}],level:2}],u={toc:p};function c(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"This is a list of all the reusable commands in CircleCI, their parameters and what they do."),(0,l.kt)("h2",{id:"install_deps"},(0,l.kt)("inlineCode",{parentName:"h2"},"install_deps")),(0,l.kt)("h3",{id:"description"},"Description"),(0,l.kt)("p",null,"This command runs the scripts that install base build dependencies and set up the ENV files for the configuration."),(0,l.kt)("p",null,"The command checks the lock to see if it matches the cached dependencies. It then installs yarn with npm, runs a yarn\ninstall to catch any missed dependencies from the cache."),(0,l.kt)("p",null,"Once complete, it then runs the yarn env: command for the specified environment"),(0,l.kt)("p",null,"It then saves the yarn cache, installs the bundler gem and then exits."),(0,l.kt)("p",null,"This command should be used for any setup that is universal to ",(0,l.kt)("em",{parentName:"p"},"all")," the builds."),(0,l.kt)("h3",{id:"parameters"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"environment"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the api environment to use for the build"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"staging")))),(0,l.kt)("h3",{id:"steps"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- restore_cache:\n    key: yarn-v1-{{ checksum "VAMobile/yarn.lock" }}-{{ arch }}\n- run:\n    command: |\n      echo INSTALLING YARN\n      npm install yarn\n      echo INSTALLING NODE MODULES\n      cd VAMobile\n      yarn install --frozen-lockfile --non-interactive\n      echo CREATING ENV FILE FOR env:<<parameters.environment>>\n      yarn env:<<parameters.environment>>\n- save_cache:\n    key: yarn-v1-{{ checksum "VAMobile/yarn.lock" }}-{{ arch }}\n    paths:\n      - VAMobile/node_modules\n- run:\n    command: |\n      echo INSTALLING BUNDLER\n      sudo gem install bundler\n')),(0,l.kt)("h3",{id:"outputs"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"install_python"},(0,l.kt)("inlineCode",{parentName:"h2"},"install_python")),(0,l.kt)("h3",{id:"description-1"},"Description"),(0,l.kt)("p",null,"This command is used to install the python dependencies for any hosted runner that does not have it installed by\ndefault. Python is required for the queueing scripts."),(0,l.kt)("p",null,"This command updates apt-get, installs python3-pip with apt-get, and installs the requests plugin for py3"),(0,l.kt)("h3",{id:"parameters-1"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-1"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run: sudo apt-get update\n- run: sudo apt-get install python3-pip\n- run: python3 -m pip install requests\n")),(0,l.kt)("h3",{id:"outputs-1"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"bundle_app"},(0,l.kt)("inlineCode",{parentName:"h2"},"bundle_app")),(0,l.kt)("h3",{id:"description-2"},"Description"),(0,l.kt)("p",null,"Bundles the app for the OS specified using the React Native bundle command"),(0,l.kt)("h3",{id:"parameters-2"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"os"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the OS to build for. ","[android, ios]"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-2"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  working_directory: ~/project/VAMobile\n  command: yarn bundle:<<parameters.os>>\n")),(0,l.kt)("h3",{id:"outputs-2"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"lint"},(0,l.kt)("inlineCode",{parentName:"h2"},"lint")),(0,l.kt)("h3",{id:"description-3"},"Description"),(0,l.kt)("p",null,"Runs the lint checks for the app. Lints error on any warnings."),(0,l.kt)("h3",{id:"parameters-3"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-3"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  working_directory: ~/project/VAMobile\n  command: yarn lint:ci\n  when: always\n")),(0,l.kt)("h3",{id:"outputs-3"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"jest"},(0,l.kt)("inlineCode",{parentName:"h2"},"jest")),(0,l.kt)("h3",{id:"description-4"},"Description"),(0,l.kt)("p",null,"Runs the automated unit tests with jest using ",(0,l.kt)("a",{parentName:"p",href:"https://circleci.com/docs/parallelism-faster-jobs/"},"time splitting"),"."),(0,l.kt)("h3",{id:"parameters-4"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-4"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- run:\n  working_directory: ~/project/VAMobile\n  command: |\n    TEST=$(circleci tests glob "src/**/*.test.ts*" | circleci tests split --split-by=timings)\n    yarn test $TEST -w 2\n  when: always\n- store_test_results:\n  path: VAMobile/coverage/junit/\n- store_artifacts:\n  path: VAMobile/coverage/junit/\n')),(0,l.kt)("h3",{id:"outputs-4"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"install_pods"},(0,l.kt)("inlineCode",{parentName:"h2"},"install_pods")),(0,l.kt)("h3",{id:"description-5"},"Description"),(0,l.kt)("p",null,"Installs the cocoa pods for any iOS builds. Not needed for Android builds. This command loads cached pods with the\npod-lock checksum at the start and saves to a cache at the end for faster builds when there have been no changes to\nthose files."),(0,l.kt)("h3",{id:"parameters-5"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-5"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- restore_cache:\n  key: pods-v1-{{ checksum "VAMobile/ios/Podfile.lock" }}-{{ arch }}\n- run:\n  working_directory: ~/project/VAMobile/ios\n  command: |\n    echo INSTALL COCOA PODS\n    pod check || pod install\n- save_cache:\n  key: pods-v1-{{ checksum "VAMobile/ios/Podfile.lock" }}-{{ arch }}\n  paths:\n    - VAMobile/ios/Pods\n')),(0,l.kt)("h3",{id:"outputs-5"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"create_keys_directory"},(0,l.kt)("inlineCode",{parentName:"h2"},"create_keys_directory")),(0,l.kt)("h3",{id:"description-6"},"Description"),(0,l.kt)("p",null,"creates a directory for the google keys because that folder is ignored by git"),(0,l.kt)("h3",{id:"parameters-6"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-6"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  command: mkdir VAMobile/android/keys\n")),(0,l.kt)("h3",{id:"outputs-6"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"decode_file"},(0,l.kt)("inlineCode",{parentName:"h2"},"decode_file")),(0,l.kt)("h3",{id:"description-7"},"Description"),(0,l.kt)("p",null,"Decodes a base64 string to a file and saves it to the specified path"),(0,l.kt)("h3",{id:"parameters-7"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"workingDir"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the directory to decode file to"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"secretString"),(0,l.kt)("td",{parentName:"tr",align:null},"base64 string value to decode"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"destination"),(0,l.kt)("td",{parentName:"tr",align:null},"Filename to save as"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-7"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  working_directory: <<parameters.workingDir>>\n  command: |\n    # decode base64 secret string\n    echo <<parameters.secretString>> | base64 --decode | tee <<parameters.destination>> >/dev/null\n")),(0,l.kt)("h3",{id:"outputs-7"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"decode_ios_keys"},(0,l.kt)("inlineCode",{parentName:"h2"},"decode_ios_keys")),(0,l.kt)("h3",{id:"description-8"},"Description"),(0,l.kt)("p",null,"This command decodes all the files needed to build and sign for iOS. It currently decodes a signing cert and a\nprovisioning profile, but that may not be necessary because of match and can be tested for removal of the\nIOS_CERTIFICATE_BASE64 and IOS_PROVISIONING_BASE64."),(0,l.kt)("h3",{id:"parameters-8"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-8"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- decode_file:\n  workingDir: '~/project/VAMobile/ios'\n  secretString: ${IOS_CERTIFICATE_BASE64}\n  destination: ${IOS_CERTIFICATE_PATH}\n- decode_file:\n  workingDir: '~/project/VAMobile/ios'\n  secretString: ${IOS_CERTIFICATE_BASE64}\n  destination: ${IOS_PROVISIONING_PATH}\n- decode_file:\n  workingDir: '~/project/VAMobile/ios'\n  secretString: ${APPSTORE_CONNECT_BASE64}\n  destination: ${APPSTORE_CONNECT_FILEPATH}\n- decode_file:\n  workingDir: '~/project/VAMobile/ios'\n  secretString: ${IOS_GS_PLIST_BASE64}\n  destination: ${IOS_GS_PLIST_PATH}\n")),(0,l.kt)("h3",{id:"outputs-8"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"ios_fastlane"},(0,l.kt)("inlineCode",{parentName:"h2"},"ios_fastlane")),(0,l.kt)("h3",{id:"description-9"},"Description"),(0,l.kt)("p",null,"This command runs all the steps and commands in order to build for iOS. This is a configurable commands that will build\nand upload to Test Flight based on the configuration options sent in."),(0,l.kt)("p",null,"This command loads cached gems at the beginning and saves them at the end for faster builds with fastlane and its\nplugins."),(0,l.kt)("p",null,"This command sets the vendor directory for ruby and updates the fastlane bundle app."),(0,l.kt)("p",null,"If a slack thread is indicated it will get that information from the attached workspace. It then runs the fastlane\nscript with the available configuration."),(0,l.kt)("h3",{id:"parameters-9"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"version"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the build type. Options are 'qa' or a version string like 'v1.1.1'"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"qa")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"lane"),(0,l.kt)("td",{parentName:"tr",align:null},"String name for the fastlane lane to run ","[qa, demo, review, release, on_demand, rc]"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"qa")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"tf_group"),(0,l.kt)("td",{parentName:"tr",align:null},"String name of the Test Flight Group to send to. See Test Flight groups in AppStoreConnect for options"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"use_slack_thread"),(0,l.kt)("td",{parentName:"tr",align:null},"Boolean value to indicate if a Slack thread should be pulled from an attached workspace"),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"true")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"notes"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for notes that show up in description in Test Flight"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("h3",{id:"steps-9"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- restore_cache:\n  key: bundle-v1-{{ checksum "VAMobile/ios/Gemfile.lock" }}-{{ arch }}\n- run:\n  working_directory: ~/project/VAMobile/ios\n  command: bundle config set --local path \'vendor/bundle\' && bundle install\n- run:\n  working_directory: ~/project/VAMobile/ios\n  command: |\n    echo UPDATING FASTLANE\n    bundle update fastlane\n- save_cache:\n  key: bundle-v1-{{ checksum "VAMobile/ios/Gemfile.lock" }}\n  paths:\n    - VAMobile/ios/vendor/bundle\n- when:\n  condition: <<parameters.use_slack_thread>>\n  steps:\n    - get_slack_thread\n- run:\n  working_directory: ~/project/VAMobile/ios\n  command: bundle exec fastlane <<parameters.lane>> version:<<parameters.version>> notes:"<<parameters.notes>>" tfGroup:"<<parameters.tf_group>>" --verbose\n  no_output_timeout: \'30m\'\n')),(0,l.kt)("h3",{id:"outputs-9"},"Outputs"),(0,l.kt)("p",null,"Uploads .ipa file to Test Flight with the configured build"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"decode_android_keys"},(0,l.kt)("inlineCode",{parentName:"h2"},"decode_android_keys")),(0,l.kt)("h3",{id:"description-10"},"Description"),(0,l.kt)("p",null,"This command decodes all the keys needed to build and upload to google play"),(0,l.kt)("h3",{id:"parameters-10"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-10"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- decode_file:\n  workingDir: '~/project/VAMobile/android/keys'\n  secretString: ${GOOGLE_KS}\n  destination: ${GOOGLE_KS_PATH}\n- decode_file:\n  workingDir: '~/project/VAMobile/android/keys'\n  secretString: ${GOOGLE_SA_JSON}\n  destination: ${GOOGLE_SA_PATH}\n- decode_file:\n  workingDir: '~/project/VAMobile/android/app'\n  secretString: ${GOOGLE_SERVICES_JSON}\n  destination: ${GOOGLE_SERVICES_PATH}\n- decode_file:\n  workingDir: '~/project/VAMobile/android/keys'\n  secretString: ${FIREBASE_DIST_FILE_BASE64}\n  destination: ${FIREBASE_DIST_DECODE_PATH}\n")),(0,l.kt)("h3",{id:"outputs-10"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"android_fastlane"},(0,l.kt)("inlineCode",{parentName:"h2"},"android_fastlane")),(0,l.kt)("h3",{id:"description-11"},"Description"),(0,l.kt)("p",null,"This command runs all the steps and commands in order to build for Android. This is a configurable commands that will\nbuild and upload to Play Store based on the configuration options sent in."),(0,l.kt)("p",null,"This command loads cached gems at the beginning and saves them at the end for faster builds with fastlane and its\nplugins."),(0,l.kt)("p",null,"This command sets the vendor directory for ruby and updates the fastlane bundle app."),(0,l.kt)("p",null,"If a slack thread is indicated it will get that information from the attached workspace. It then runs the fastlane\nscript with the available configuration."),(0,l.kt)("h3",{id:"parameters-11"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"version"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the build type. Options are 'qa' or a version string like 'v1.1.1'"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"qa")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"lane"),(0,l.kt)("td",{parentName:"tr",align:null},"String name for the fastlane lane to run ","[qa, demo, review, release, on_demand, rc, firebase_app_dist_add_testers, firebase_app_dist_remove_testers]"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"qa")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"ps_track"),(0,l.kt)("td",{parentName:"tr",align:null},"String name of the Play Store Lane to send to. See Play Store Closed Testing groups for options"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"use_slack_thread"),(0,l.kt)("td",{parentName:"tr",align:null},"Boolean value to indicate if a Slack thread should be pulled from an attached workspace"),(0,l.kt)("td",{parentName:"tr",align:null},"boolean"),(0,l.kt)("td",{parentName:"tr",align:null},"true")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"notes"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for notes that show up in description in Firebase Distribution"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null})))),(0,l.kt)("h3",{id:"steps-11"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- restore_cache:\n  key: bundle-v1-{{ checksum "VAMobile/android/Gemfile.lock" }}-{{ arch }}\n- run:\n  working_directory: ~/project/VAMobile/android\n  command: bundle check || bundle config set --local path \'vendor/bundle\' && bundle install\n- run:\n  working_directory: ~/project/VAMobile/android\n  command: |\n    echo UPDATING FASTLANE\n    bundle update fastlane\n- save_cache:\n  key: bundle-v1-{{ checksum "VAMobile/android/Gemfile.lock" }}\n  paths:\n    - VAMobile/android/vendor/bundle\n- when:\n  condition: <<parameters.use_slack_thread>>\n  steps:\n    - get_slack_thread\n- run:\n  working_directory: ~/project/VAMobile/android\n  command: bundle exec fastlane <<parameters.lane>> --verbose version:<<parameters.version>> notes:"<<parameters.notes>>" psTrack:"<<parameters.ps_track>>"\n')),(0,l.kt)("h3",{id:"outputs-11"},"Outputs"),(0,l.kt)("p",null,".aab file sent to Play Store"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"run_script"},(0,l.kt)("inlineCode",{parentName:"h2"},"run_script")),(0,l.kt)("h3",{id:"description-12"},"Description"),(0,l.kt)("p",null,"Runs a bash script."),(0,l.kt)("p",null,"Takes the working directory, script name and script options as params"),(0,l.kt)("p",null,"This is useful if there is a script that needs to be run in different directories, allowing you to write once and use\neverywhere."),(0,l.kt)("p",null,"This command runs chmod +x on the script to ensure it is executable in the CI runner."),(0,l.kt)("h3",{id:"parameters-12"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"workingDir"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the directory to decode file to"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"~/project/VAMobile")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"script_name"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for the name of the script, i.e. run_me.sh"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"script_options"),(0,l.kt)("td",{parentName:"tr",align:null},"String value for any flags or options that need to be set on the script"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-12"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  working_directory: <<parameters.workingDir>>\n  command: |\n    chmod +x <<parameters.script_name>>\n    bash <<parameters.script_name>> <<parameters.script_options>>\n")),(0,l.kt)("h3",{id:"outputs-12"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"get_slack_channel_id"},(0,l.kt)("inlineCode",{parentName:"h2"},"get_slack_channel_id")),(0,l.kt)("h3",{id:"description-13"},"Description"),(0,l.kt)("p",null,"Checks DSVA slack to get the channel id from a channel name."),(0,l.kt)("p",null,"Slack can sometimes change the channel id and channel name is not reliable to send messages so we search for the id by\nchannel name and set it to the BASH ENV on the runner."),(0,l.kt)("h3",{id:"parameters-13"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channelName"),(0,l.kt)("td",{parentName:"tr",align:null},"String of the channel name in VA DSVA Slack that you want to post to"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-13"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  name: 'Find the right channel id since it can sometimes change'\n  command: |\n    id=$(curl -X GET -H 'Authorization: Bearer '\"$SLACK_API_TOKEN\"' ' \\\n      -H 'Content-type: application/x-www-form-urlencoded' \\\n      https://slack.com/api/conversations.list\\?limit=1000 |\n      jq '.channels[] | .name as $data | select($data == \"<<parameters.channelName>>\").id' )\n    echo \"export SLACK_CHANNEL_ID=${id}\" >> $BASH_ENV\n")),(0,l.kt)("h3",{id:"outputs-13"},"Outputs"),(0,l.kt)("p",null,"BASH_ENV::SLACK_CHANNEL_ID"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"send_slack_message"},(0,l.kt)("inlineCode",{parentName:"h2"},"send_slack_message")),(0,l.kt)("h3",{id:"description-14"},"Description"),(0,l.kt)("p",null,"Sends a slack message in the specified channel and sets the SLACK_THREAD_TS ENV var"),(0,l.kt)("h3",{id:"parameters-14"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channelId"),(0,l.kt)("td",{parentName:"tr",align:null},"String value of the Slack channel id is VA DSVA Slack that you want to send a message to"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"message"),(0,l.kt)("td",{parentName:"tr",align:null},"The string message that you want to send to the channel."),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-14"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run:\n  name: 'Post message to slack'\n  command: |\n    ts=$(curl -X POST -H 'Authorization: Bearer '\"$SLACK_API_TOKEN\"' ' \\\n      -H 'Content-type: application/json' \\\n      --data '{\"channel\":\"'<<parameters.channelId>>'\",\"text\":\"<<parameters.message>>\"}' \\\n      https://slack.com/api/chat.postMessage|\n      jq -r '.ts')\n    echo \"export SLACK_THREAD_TS=${ts}\" >> $BASH_ENV\n")),(0,l.kt)("h3",{id:"outputs-14"},"Outputs"),(0,l.kt)("p",null,"BASH_ENV::SLACK_THREAD_TS"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"persist_env"},(0,l.kt)("inlineCode",{parentName:"h2"},"persist_env")),(0,l.kt)("h3",{id:"description-15"},"Description"),(0,l.kt)("p",null,"Persist a bash env to the workspace for other jobs"),(0,l.kt)("p",null,"This command creates a ",(0,l.kt)("a",{parentName:"p",href:"https://circleci.com/docs/workspaces/"},"workspace")," in the CircleCI runner in order to share\npersisted environment variables across concurrent jobs, since they are running on separate VMs"),(0,l.kt)("h3",{id:"parameters-15"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"envVar"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of the environment variable to persist to a workspace, i.e. MY_ENV_VAR"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"path"),(0,l.kt)("td",{parentName:"tr",align:null},"String name of workspace path. Can be whatever to just indicate a unique workspace. ",(0,l.kt)("inlineCode",{parentName:"td"},"save_slack_thread")," uses a path of 'threadTs` to save to a unique workspace for threading messages."),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-15"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- run: mkdir -p workspace\n- run: echo << parameters.envVar >> > workspace/<< parameters.path >>\n- persist_to_workspace:\n  root: workspace\n  paths:\n    - << parameters.path >>\n")),(0,l.kt)("h3",{id:"outputs-15"},"Outputs"),(0,l.kt)("p",null,"creates a workspace at ",(0,l.kt)("inlineCode",{parentName:"p"},"workspace/<path>")," with BASH_ENV::envVar"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"retrieve_persisted_env"},(0,l.kt)("inlineCode",{parentName:"h2"},"retrieve_persisted_env")),(0,l.kt)("h3",{id:"description-16"},"Description"),(0,l.kt)("p",null,"This command pulls in a workspace and persists a BASH_ENV from that workspace onto the runner"),(0,l.kt)("h3",{id:"parameters-16"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"envVar"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of the environment variable to pull from a workspace into the runner, i.e. MY_ENV_VAR"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"path"),(0,l.kt)("td",{parentName:"tr",align:null},"String name of workspace path that you would like to persist an ENV from"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"none")))),(0,l.kt)("h3",{id:"steps-16"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- attach_workspace:\n  at: /tmp/workspace\n- run:\n  command: |\n    echo `cat /tmp/workspace/<< parameters.path >>`\n    var=$(cat /tmp/workspace/<< parameters.path >>)\n    echo "export <<parameters.envVar>>=${var}" >> $BASH_ENV\n')),(0,l.kt)("h3",{id:"outputs-16"},"Outputs"),(0,l.kt)("p",null,"BASH_ENV::envVar"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"save_slack_thread"},(0,l.kt)("inlineCode",{parentName:"h2"},"save_slack_thread")),(0,l.kt)("h3",{id:"description-17"},"Description"),(0,l.kt)("p",null,"Uses the ",(0,l.kt)("a",{parentName:"p",href:"#persist_env"},(0,l.kt)("inlineCode",{parentName:"a"},"persist_env"))," command to save the Thread TS variable for a Slack thread onto the workspace."),(0,l.kt)("h3",{id:"parameters-17"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-17"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- persist_env:\n  envVar: ${SLACK_THREAD_TS}\n  path: 'threadTs\n")),(0,l.kt)("h3",{id:"outputs-17"},"Outputs"),(0,l.kt)("p",null,"Creates a workspace at ",(0,l.kt)("inlineCode",{parentName:"p"},"workspace/threadTs")," with BASH_ENV::SLACK_THREAD_TS persisted"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"get_slack_thread"},(0,l.kt)("inlineCode",{parentName:"h2"},"get_slack_thread")),(0,l.kt)("h3",{id:"description-18"},"Description"),(0,l.kt)("p",null,"Retrieves the workspace at ",(0,l.kt)("inlineCode",{parentName:"p"},"workspace/threadTs")," and persists the workspace SLACK_THREAD_TS to the current runner."),(0,l.kt)("h3",{id:"parameters-18"},"Parameters"),(0,l.kt)("p",null,"None"),(0,l.kt)("h3",{id:"steps-18"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"- retrieve_persisted_env:\n  envVar: 'SLACK_THREAD_TS'\n  path: 'threadTs'\n")),(0,l.kt)("h3",{id:"outputs-18"},"Outputs"),(0,l.kt)("p",null,"BASH_ENV::SLACK_THREAD_TS"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"queue_android_jobs"},(0,l.kt)("inlineCode",{parentName:"h2"},"queue_android_jobs")),(0,l.kt)("h3",{id:"description-19"},"Description"),(0,l.kt)("p",null,"This command runs the queue job for Android builds."),(0,l.kt)("p",null,"Python does not come pre-installed on the Android runners in CircleCI, so this command calls\nthe ",(0,l.kt)("a",{parentName:"p",href:"#install_python"},(0,l.kt)("inlineCode",{parentName:"a"},"install_python"))," command before it runs the queue script"),(0,l.kt)("p",null,"The BUILD_REGEX value is saved to the BASH_ENV so that the queue script can pick up the job filter"),(0,l.kt)("h3",{id:"parameters-19"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"regex"),(0,l.kt)("td",{parentName:"tr",align:null},"Regular expression string for the filtering of jobs in the queue. Usually just '^build",(0,l.kt)("em",{parentName:"td"},"android"),"' or '^build",(0,l.kt)("em",{parentName:"td"},"ios"),"' but can be any filter of job names in the config"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"^build",(0,l.kt)("em",{parentName:"td"},"android"))))),(0,l.kt)("h3",{id:"steps-19"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- run: echo "export BUILD_REGEX=<<parameters.regex>>" >> $BASH_ENV\n- install_python\n- run:\n  working_directory: ~/project/VAMobile\n  command: python3 queue-builds.py  \n')),(0,l.kt)("h3",{id:"outputs-19"},"Outputs"),(0,l.kt)("p",null,"None"),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"queue_ios_jobs"},(0,l.kt)("inlineCode",{parentName:"h2"},"queue_ios_jobs")),(0,l.kt)("h3",{id:"description-20"},"Description"),(0,l.kt)("p",null,"This command runs the queue job for iOS builds."),(0,l.kt)("p",null,"Pyhton3 is pre-installed on the Mac runners, but does not have the requests plugin installed. This command installs that plugin before running the script."),(0,l.kt)("p",null,"The BUILD_REGEX value is saved to the BASH_ENV so that the queue script can pick up the job filter"),(0,l.kt)("h3",{id:"parameters-20"},"Parameters"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Name"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"),(0,l.kt)("th",{parentName:"tr",align:null},"type"),(0,l.kt)("th",{parentName:"tr",align:null},"default?"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"regex"),(0,l.kt)("td",{parentName:"tr",align:null},"Regular expression string for the filtering of jobs in the queue. Usually just '^build",(0,l.kt)("em",{parentName:"td"},"android"),"' or '^build",(0,l.kt)("em",{parentName:"td"},"ios"),"' but can be any filter of job names in the config"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"^build",(0,l.kt)("em",{parentName:"td"},"ios"))))),(0,l.kt)("h3",{id:"steps-20"},"Steps"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- run: echo "export BUILD_REGEX=<<parameters.regex>>" >> $BASH_ENV\n- run: python3 -m pip install requests\n- run:\n  working_directory: ~/project/VAMobile\n  command: python3 queue-builds.py\n')),(0,l.kt)("h3",{id:"outputs-20"},"Outputs"),(0,l.kt)("p",null,"None"))}c.isMDXComponent=!0}}]);