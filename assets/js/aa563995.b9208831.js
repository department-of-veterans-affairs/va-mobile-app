"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5534],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var i=t(96540);const o={},s=i.createContext(o);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(s.Provider,{value:n},e.children)}},63075:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/push_postman_collection-701055609ec693d4be265b57e104713e.png"},78338:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"FrontEnd/Push Notifications","title":"Push notifications","description":"Overview","source":"@site/development/FrontEnd/Push Notifications.md","sourceDirName":"FrontEnd","slug":"/FrontEnd/Push Notifications","permalink":"/va-mobile-app/development/FrontEnd/Push Notifications","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Push notifications"},"sidebar":"tutorialSidebar","previous":{"title":"Offline mode","permalink":"/va-mobile-app/development/FrontEnd/Offline Mode"},"next":{"title":"Remote config","permalink":"/va-mobile-app/development/FrontEnd/RemoteConfig"}}');var o=t(74848),s=t(28453);const a={title:"Push notifications"},r=void 0,l={},c=[{value:"Overview",id:"overview",level:2},{value:"Setting up push notifications",id:"setting-up-push-notifications",level:2},{value:"Adding a new deep link",id:"adding-a-new-deep-link",level:2},{value:"Passing props to screens",id:"passing-props-to-screens",level:3},{value:"Handling back navigation",id:"handling-back-navigation",level:2},{value:"Testing deep links",id:"testing-deep-links",level:2},{value:"Local testing",id:"local-testing",level:3},{value:"uri-scheme",id:"uri-scheme",level:4},{value:"Xcode command-line tools",id:"xcode-command-line-tools",level:4},{value:"Detox",id:"detox",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"Push notifications should be used only when they provide timely or important information to Veterans. They are most appropriate for reminders about appointments, prescription refills, or requests for claim evidence. Routine updates that are not urgent should remain in the app."}),"\n",(0,o.jsx)(n.p,{children:"Notification frequency should be managed carefully. Teams should coordinate to avoid sending multiple messages in a short period, and when there are several updates, they should be combined into a single notification where possible. Both Apple and Android provide standards for grouping notifications, which should be followed."}),"\n",(0,o.jsx)(n.p,{children:"Content should be clear, concise, and written in plain language. Veterans should be able to dismiss notifications at any time. If a notification is tapped, it should take the user directly to the appropriate location in the app. Notifications should also expire automatically after a set period."}),"\n",(0,o.jsx)(n.p,{children:"Success should be measured by tracking how many Veterans keep notifications enabled, how often they interact with them, and whether the intended action is completed. These insights can guide improvements to timing, frequency, and message design. Some helpful metrics to track include:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"delivery rate (percentage of messages that reach devices)"}),"\n",(0,o.jsx)(n.li,{children:"open rate (percentage of users who open after receiving)"}),"\n",(0,o.jsx)(n.li,{children:"conversion rate (percentage of users who complete the intended action)"}),"\n",(0,o.jsx)(n.li,{children:"opt-out rate (percentage of users who disable the notification)"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"setting-up-push-notifications",children:"Setting up push notifications"}),"\n",(0,o.jsx)(n.p,{children:"Deep links in the app are handled by the React Navigation library. The React Navigation linking configuration handles mapping links to the appropriate screens, and updating the navigation state when necessary."}),"\n",(0,o.jsxs)(n.p,{children:["A prerequisite for adding deep linking support for a feature's push notification is to have push notifications setup for that feature. An architectural overview of how push notifications work in the app and information on how to add them for a feature can be found ",(0,o.jsx)(n.a,{href:"/va-mobile-app/development/BackEnd/Features/PushNotifications",children:"in push notification documentation"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["In order for deep linking to work for your push notification, the ",(0,o.jsx)(n.code,{children:"url"})," field must be present in the push template. The URL should be prefixed with ",(0,o.jsx)(n.code,{children:"vamobile://"})," and followed by the path of the deep link you want to add, e.g. ",(0,o.jsx)(n.code,{children:"vamobile://messages/%MSG_ID%"}),". In this example, the path of the deep link is prefixed with ",(0,o.jsx)(n.code,{children:"vamobile://"}),", starts with ",(0,o.jsx)(n.code,{children:"messages"}),", and is followed by the ",(0,o.jsx)(n.code,{children:"MSG_ID"})," parameter, which is a field that will be populated from the API call that triggers the push notification. This will result in push notifications returning a payload that looks something like:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  ...\n  "url": "vamobile://messages/1234"\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"adding-a-new-deep-link",children:"Adding a new deep link"}),"\n",(0,o.jsxs)(n.p,{children:["To map your push notification to a specific screen, you'll need to update the ",(0,o.jsx)(n.code,{children:"config"})," object in the ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/8daf0536ebbf801de0ed63e0b2af9385d54b1bc1/VAMobile/src/constants/linking.tsx",children:"React Navigation linking configuration"}),". ",(0,o.jsx)(n.code,{children:"config"})," contains a ",(0,o.jsx)(n.code,{children:"screens"})," object, which is based on the navigation structure of the app. Within that object, the key represents the route name of the screen in the navigation stack, and the value represents the URL that should be mapped to that screen. Route names in ",(0,o.jsx)(n.code,{children:"config"})," can also nest other ",(0,o.jsx)(n.code,{children:"screens"})," objects for child routes. For reference, the configuration can look something like this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"config: {\n  screens: {\n    Tabs: {\n      screens: {\n        HealthTab: {\n          screens: {\n            ViewMessageScreen: 'messages/:messageID',\n          },\n        },\n      },\n    },\n  },\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["You'll notice the entry for the screen ",(0,o.jsx)(n.code,{children:"ViewMessageScreen"})," is nested under other screens like ",(0,o.jsx)(n.code,{children:"HealthTab"})," and ",(0,o.jsx)(n.code,{children:"Tabs"}),". This reflects the structure of the app's navigation stack. Starting from the ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/8daf0536ebbf801de0ed63e0b2af9385d54b1bc1/VAMobile/src/App.tsx#L313-L334",children:"root navigator"}),", you can trace the stack by viewing the ",(0,o.jsx)(n.code,{children:"component"})," prop of the route in the stack until you arrive at the screen you want. Using the example above, the ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/8daf0536ebbf801de0ed63e0b2af9385d54b1bc1/VAMobile/src/App.tsx#L326",children:"Tabs"})," route is mapped to the ",(0,o.jsx)(n.code,{children:"AppTabs"})," component, which is where most of the screens in the app fall under. In the ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/8daf0536ebbf801de0ed63e0b2af9385d54b1bc1/VAMobile/src/App.tsx#L279-L292",children:"AppTabs"})," component, you'll see a navigation stack containing the ",(0,o.jsx)(n.code,{children:"HealthTab"})," route, which maps to the ",(0,o.jsx)(n.code,{children:"HealthScreen"})," screen. In the ",(0,o.jsx)(n.code,{children:"HealthScreen"})," component, you'll see a ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/cc92f2f99be1afc2fb3712a858f3351f964b1905/VAMobile/src/screens/HealthScreen/HealthScreen.tsx#L151-L174",children:"navigation stack"})," containing all the health screens. From that list, you'll find the ",(0,o.jsx)(n.code,{children:"ViewMessageScreen"})," route, which finally maps to the ",(0,o.jsx)(n.code,{children:"ViewMessageScreen"})," component. Following these steps can make it easier to determine the structure of your deep link when updating the linking configuration."]}),"\n",(0,o.jsx)(n.h3,{id:"passing-props-to-screens",children:"Passing props to screens"}),"\n",(0,o.jsxs)(n.p,{children:["From the example above, the URI endpoint ",(0,o.jsx)(n.code,{children:"messages/:messageID"})," is being mapped to the ",(0,o.jsx)(n.code,{children:"ViewMessageScreen"})," screen, where ",(0,o.jsx)(n.code,{children:":messageID"})," is a parameter that is expected to be in the URI. That parameter will be passed to the screen's props. The name of the parameter in the URL must match the name of the prop in the screen's component in order for it to be passed to the component, so in this example, the ",(0,o.jsx)(n.code,{children:"ViewMessageScreen"})," component has a prop named ",(0,o.jsx)(n.code,{children:"messageID"})," as well. More information on passing parameters can be found in the ",(0,o.jsx)(n.a,{href:"https://reactnavigation.org/docs/configuring-links#passing-params",children:"React Navigation documentation"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"handling-back-navigation",children:"Handling back navigation"}),"\n",(0,o.jsx)(n.p,{children:"Once you've added your deep link to the linking configuration, depending on how nested the screen is in the app, one issue you may run into is navigating backwards. Navigating back from screens opened via a deep link will typically go back to the home screen. This is because React Navigation isn't able to automatically generate the correct navigation state when a deep link is opened. The navigation state will need to be manually generated to ensure navigating back after opening a deep link takes the user to the correct screen."}),"\n",(0,o.jsxs)(n.p,{children:["In the linking configuration, the ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/8daf0536ebbf801de0ed63e0b2af9385d54b1bc1/VAMobile/src/constants/linking.tsx#L27-L49",children:"getStateFromPath"})," function can be used for manually setting the navigation state based on the path of the opened deep link. Logic added here shouldn't conflict with logic for other deep links. The generated navigation state for ",(0,o.jsx)(n.code,{children:"ViewMessageScreen"})," from the previous examples looks like this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:"{\n  routes: [\n    {\n      name: 'Tabs',\n      state: {\n        routes: [\n          {\n            name: 'HealthTab',\n            state: {\n              routes: [{ name: 'Health' }, { name: 'SecureMessaging' }, { name: 'ViewMessageScreen', params: { messageID: pathParts[1] } }],\n            },\n          },\n        ],\n      },\n    },\n  ],\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The state should match the behavior you'd see if you were manually navigating from the home screen to the desired screen. The navigation state should be returned by the function if the ",(0,o.jsx)(n.code,{children:"path"})," parameter matches the pattern specified in the ",(0,o.jsx)(n.code,{children:"config"})," object. This will ensure that navigating back from the screen opened by a push notification produces expected behavior."]}),"\n",(0,o.jsxs)(n.p,{children:["More information on navigation state can be found in the ",(0,o.jsx)(n.a,{href:"https://reactnavigation.org/docs/navigation-state",children:"React Navigation documentation"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"testing-deep-links",children:"Testing deep links"}),"\n",(0,o.jsx)(n.p,{children:"Once you've configured deep linking for your push notification, you'll be able to test it by triggering push notifications remotely from the responsible service. The VANotify API can also be used to send push notifications to a device, but this requires an API key that will need to be provided by the VANotify team."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Contact VANotify on Slack ",(0,o.jsx)(n.a,{href:"https://dsva.slack.com/archives/C010R6AUPHT",children:"#va-notify-public"})," to receive an API key to start testing. Note that this API key will be sent to your VA email."]}),"\n",(0,o.jsxs)(n.li,{children:["Download the ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/notification-api/blob/main/documents/postman/README.md",children:"postman collection"})," provided by VANotify.","\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"staging-simplified.postman_environment.json"})," should be imported to your Postman ",(0,o.jsx)(n.code,{children:"Environments"}),". The ",(0,o.jsx)(n.code,{children:"serviceId"})," and ",(0,o.jsx)(n.code,{children:"api-key"})," should be included in the email.\n",(0,o.jsx)(n.img,{alt:"Postman Environment",src:t(92730).A+"",width:"1484",height:"495"})]}),"\n",(0,o.jsxs)(n.li,{children:["The ",(0,o.jsx)(n.code,{children:"notification-api-simplified.postman_collection.json"})," file should be imported to your Postman ",(0,o.jsx)(n.code,{children:"Collections"}),". Ensure that the correct environment is chosen for the collection.\n",(0,o.jsx)(n.img,{alt:"Postman Collection",src:t(63075).A+"",width:"1487",height:"466"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["The main endpoint that will be used to send push notifications will be ",(0,o.jsx)(n.code,{children:"/v2/notifications/push"}),". This endpoint uses ",(0,o.jsx)(n.code,{children:"{{icn}}"}),", which corresponds to a staging user that the push notification will be sent to and a ",(0,o.jsx)(n.code,{children:"{{vetext-template-id}}"}),", which is the type of push notification that is sent (ex. Secure messaging or Appointment). These values can be populated in the environment file."]}),"\n",(0,o.jsxs)(n.li,{children:["Hit ",(0,o.jsx)(n.code,{children:"Send"})," on Postman to send a push notification. Note that a notification will be sent to everyone who is logged into that user."]}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{type:"note",children:[(0,o.jsx)(n.mdxAdmonitionTitle,{}),(0,o.jsxs)(n.p,{children:["Remote push notifications will only work on a physical device with a non-development build installed, so you'll need to run an ",(0,o.jsx)(n.a,{href:"/va-mobile-app/development/QA/QABuilds#on-demand-builds",children:"on demand build"})," for your branch as well as log in with a staging user."]})]}),"\n",(0,o.jsx)(n.h3,{id:"local-testing",children:"Local testing"}),"\n",(0,o.jsxs)(n.p,{children:["If you're not able to test your deep link via remote push notifications, or would like a quicker way of testing, you can test your deep link locally with either ",(0,o.jsx)(n.a,{href:"https://github.com/expo/expo-cli/tree/main/packages/uri-scheme",children:"uri-scheme"})," or [Detox](../../gettingStarted/SetUp/DevelopmentSetUpProcess/QA resources/index.md#detox-our-ui-automation-tool)."]}),"\n",(0,o.jsx)(n.h4,{id:"uri-scheme",children:"uri-scheme"}),"\n",(0,o.jsx)(n.p,{children:"This is a CLI tool used for testing native URI schemes on both iOS and Android. This approach will work with a virtual device. To test your deep link, you can run the following command in your terminal:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'npx uri-scheme open "{THE_FULL_URL}" --{DEVICE_PLATFORM}\n'})}),"\n",(0,o.jsx)(n.p,{children:"This will launch the app with the provided URL, similar to how a push notification with deep linking configured would. Using the example from earlier, running this for the iOS simulator would look something like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'npx uri-scheme open "vamobile://messages/1234" --ios\n'})}),"\n",(0,o.jsx)(n.h4,{id:"xcode-command-line-tools",children:"Xcode command-line tools"}),"\n",(0,o.jsxs)(n.p,{children:["For testing on iOS, you can simulate a push notification using Xcode's command-line tools. First, you will need to define a ",(0,o.jsx)(n.a,{href:"https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/CreatingtheNotificationPayload.html",children:"remote notification payload"})," in a ",(0,o.jsx)(n.code,{children:"payload.json"})," file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "url": "vamobile://messages/1234",\n  "aps": {\n    "alert": {\n      "title": "VA Mobile App",\n      "body": "Notification body text"\n    }\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Then, you can use ",(0,o.jsx)(n.code,{children:"xcrun"})," to send a push notification to the iOS simulator by running the following command in your terminal:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"xcrun simctl push booted gov.va.vamobileapp payload.json\n"})}),"\n",(0,o.jsx)(n.p,{children:"A push notification will appear in the simulator with the specified title and body text. When tapped, it will open the deep link provided in the url field."}),"\n",(0,o.jsx)(n.h4,{id:"detox",children:"Detox"}),"\n",(0,o.jsxs)(n.p,{children:["You can also use our automated UI testing tool Detox to simulate push notifications on a virtual device. Detox supports ",(0,o.jsx)(n.a,{href:"https://wix.github.io/Detox/docs/guide/mocking-user-notifications/",children:"mocking push notifications"}),", which provides a more complete view of how the app will behave when a deep link is opened from a push notification. Since Detox is already used in our repository, all you'll need to do is create a new test for your push notification, and run it locally. ",(0,o.jsx)(n.a,{href:"https://github.com/department-of-veterans-affairs/va-mobile-app/blob/develop/VAMobile/e2e/tests/PushNotifications.e2e.ts",children:"View an example of a Detox test for a push notification"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},92730:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/push_postman_env-6452c73d41493a0fa786f91b0a6bd297.png"}}]);