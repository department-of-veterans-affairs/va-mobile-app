<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-development docs-version-current docs-doc-page docs-doc-id-BackEnd/Testing/LocalInstances" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Local Instances (with upstream staging data) | VA: Health and Benefits app documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://department-of-veterans-affairs.github.io/va-mobile-app/development/BackEnd/Testing/LocalInstances"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-development-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-development-current"><meta data-rh="true" property="og:title" content="Local Instances (with upstream staging data) | VA: Health and Benefits app documentation"><meta data-rh="true" name="description" content="While it is possible to test local changes in vets-api against mock data or VCR Cassettes, sometimes it may be beneficial or even necessary to test those changes using data for one our many staging users. To do this, a few things need to happen:"><meta data-rh="true" property="og:description" content="While it is possible to test local changes in vets-api against mock data or VCR Cassettes, sometimes it may be beneficial or even necessary to test those changes using data for one our many staging users. To do this, a few things need to happen:"><link data-rh="true" rel="icon" href="/va-mobile-app/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://department-of-veterans-affairs.github.io/va-mobile-app/development/BackEnd/Testing/LocalInstances"><link data-rh="true" rel="alternate" href="https://department-of-veterans-affairs.github.io/va-mobile-app/development/BackEnd/Testing/LocalInstances" hreflang="en"><link data-rh="true" rel="alternate" href="https://department-of-veterans-affairs.github.io/va-mobile-app/development/BackEnd/Testing/LocalInstances" hreflang="x-default"><link rel="stylesheet" href="/va-mobile-app/assets/css/styles.dd89ede4.css">
<script src="/va-mobile-app/assets/js/runtime~main.abd3bd7e.js" defer="defer"></script>
<script src="/va-mobile-app/assets/js/main.3e5c9de2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/va-mobile-app/img/va-logo.png"><link rel="preload" as="image" href="/va-mobile-app/img/va-blue-logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/va-mobile-app/"><div class="navbar__logo"><img src="/va-mobile-app/img/va-logo.png" alt="VA Mobile logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/va-mobile-app/img/va-logo.png" alt="VA Mobile logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">VA Mobile Docs</b></a><a class="navbar__item navbar__link" href="/va-mobile-app/gettingStarted/Intro">Getting started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/va-mobile-app/development/Intro">Development guide</a><a class="navbar__item navbar__link" href="/va-mobile-app/communityAndSupport/Intro">Community and support</a><a class="navbar__item navbar__link" href="/va-mobile-app/design/Intro">Design system</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/department-of-veterans-affairs/va-mobile-app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/va-mobile-app/development/Intro">Development guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/va-mobile-app/development/BackEnd/">Back end</a><button aria-label="Collapse sidebar category &#x27;Back end&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/development/BackEnd/API">API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/va-mobile-app/development/BackEnd/Architecture/AddressUpdateFlow">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/va-mobile-app/development/BackEnd/Features/CustomErrorResponses">Features</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/va-mobile-app/development/BackEnd/Monitoring/DataDog">Monitoring</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/">Testing</a><button aria-label="Collapse sidebar category &#x27;Testing&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/ApiTokens">API tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/LocalInstances">Local Instances (with upstream staging data)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/Postman">Postman</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/ReviewInstances">Review instances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/Specs">Specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/va-mobile-app/development/BackEnd/Testing/StagingInstances">Staging instances</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/development/FrontEnd/">Front end</a><button aria-label="Expand sidebar category &#x27;Front end&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/va-mobile-app/development/DevOps/AutomationCodeDocs/GitHubActions/">Dev ops</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/development/Design/">Design</a><button aria-label="Expand sidebar category &#x27;Design&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/va-mobile-app/development/QA/">Quality assurance</a><button aria-label="Expand sidebar category &#x27;Quality assurance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/va-mobile-app/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/va-mobile-app/development/BackEnd/"><span itemprop="name">Back end</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/va-mobile-app/development/BackEnd/Testing/"><span itemprop="name">Testing</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Local Instances (with upstream staging data)</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Local Instances (with upstream staging data)</h1></header><p>While it is possible to test local changes in vets-api against <a href="https://github.com/department-of-veterans-affairs/vets-api-mockdata" target="_blank" rel="noopener noreferrer">mock data</a> or VCR Cassettes, sometimes it may be beneficial or even necessary to test those changes using data for one our many <a href="https://github.com/department-of-veterans-affairs/va.gov-team-sensitive/blob/master/Administrative/vagov-users/mvi-staging-users.csv" target="_blank" rel="noopener noreferrer">staging users</a>. To do this, a few things need to happen:</p>
<ul>
<li>The Mobile App (or Postman) must be authenticated for the Test User for whom you wish to access their data</li>
<li>Your local vets-api instance must be configured properly<!-- -->
<ul>
<li>You must have the proper Staging settings pulled into your local settings</li>
<li>Temporary configurations, such as disabling SSL, must be put in place</li>
</ul>
</li>
<li>Your local vets-api instance must be able to connect to upstream staging services, which exist within the VA network, and are not immediately accessible otherwise without the proper tooling.</li>
</ul>
<p>Two such tools are available for you that simplify these processes: <a href="https://va-mobile-dev-tools-0cb741eb06ae.herokuapp.com/mobile-authentication" target="_blank" rel="noopener noreferrer">Mobile DevTools: Mobile Authentication</a> for the authentication piece, and Upstream-Connect, a CLI tool in vets-api that automates configuring your local instance and connecting to upstream environments.</p>
<p>Once both pieces are working properly, a user should be able to successfully make requests from Postman or a local build of the Mobile app to a local instance of vets-api and finally to the various upstream services using a staging user of their choice.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mobile-devtools--mobile-authentication">Mobile DevTools / Mobile Authentication<a href="#mobile-devtools--mobile-authentication" class="hash-link" aria-label="Direct link to Mobile DevTools / Mobile Authentication" title="Direct link to Mobile DevTools / Mobile Authentication">​</a></h2>
<p>Mobile DevTools is a standalone application deployed <a href="https://va-mobile-dev-tools-0cb741eb06ae.herokuapp.com/" target="_blank" rel="noopener noreferrer">here</a>. One of the tools available is &quot;Mobile Authentication&quot;, which allows users to retrieve access tokens for either the Staging environment or locally running instances of Vets API. Both options utilize the Staging deployment of ID.me, allowing users access to <a href="https://github.com/department-of-veterans-affairs/va.gov-team-sensitive/blob/master/Administrative/vagov-users/mvi-staging-users.csv" target="_blank" rel="noopener noreferrer">Test User</a> data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authenticating-with-postman-to-test-local-changes">Authenticating with Postman to Test Local changes<a href="#authenticating-with-postman-to-test-local-changes" class="hash-link" aria-label="Direct link to Authenticating with Postman to Test Local changes" title="Direct link to Authenticating with Postman to Test Local changes">​</a></h3>
<p>When running vets-api locally, you cannot hit a mobile endpoint out of the box. You must have an access token imbedded with the identity of the intended Test User. Retrieving a token has become a simple process using our Mobile DevTools, once you have completed the pre-reqs (one time only):</p>
<ul>
<li><a href="https://github.com/department-of-veterans-affairs/vets-api" target="_blank" rel="noopener noreferrer">vets-api</a> is cloned, set up and working properly. This includes having bundled and all migrations run. See the vets-api README for help with this.</li>
<li><a href="https://github.com/department-of-veterans-affairs/vets-api-mockdata" target="_blank" rel="noopener noreferrer">vets-api-mockdata</a> cloned in sibling directorty (nothing to setup)</li>
<li>ngrok account created, installed, and configured. See <a href="https://github.com/department-of-veterans-affairs/va-mobile-dev-tools/blob/main/README.md#ngrok-setup" target="_blank" rel="noopener noreferrer">DevTools README</a></li>
</ul>
<p>Once the pre-reqs are set up, follow these steps:</p>
<ol>
<li>Start vets-api (<code>bundle exec rails server</code>)</li>
<li>Start ngrok (<code>ngrok http 3000</code>)</li>
<li>Visit <a href="https://va-mobile-dev-tools-0cb741eb06ae.herokuapp.com/mobile-authentication" target="_blank" rel="noopener noreferrer"> Mobile DevTools/Mobile Authentication</a></li>
</ol>
<ul>
<li>You may need to log in to github if it&#x27;s your first time or have been logged out</li>
</ul>
<ol start="4">
<li>For <code>Authentication Environment</code>, select <code>Local Token</code></li>
<li>Enter your ngrok URL</li>
</ol>
<ul>
<li>Can be found next to <code>Forwarding</code> in your ngrok session. Something like <code>https://some-random-words.ngrok-free.dev</code></li>
</ul>
<ol start="6">
<li>Proceed to ID.me to enter Test User credentials for your User</li>
</ol>
<p><strong>NOTE</strong> If you run into some sort of warning, you can safely select <code>Visit Site</code>. We trust ourselves.
<strong>NOTE</strong> If you get an error about a client ID, you are missing some local seed data. If you don&#x27;t care about the state of your current test DB, just run <code>bin/rails db:reset db:migrate</code> and that should give you the config objects you need.</p>
<ol start="7">
<li>This should complete and provide you with an access token (refreshable via UI). This token can be set as your <code>Bearer Token</code> in Postman for Mobile Requests</li>
<li>You should now be able to make changes to vets-api and see them reflected against the mock-data repo. To test against upstream data, see Upstream-Connect below.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="postman-collection">Postman Collection<a href="#postman-collection" class="hash-link" aria-label="Direct link to Postman Collection" title="Direct link to Postman Collection">​</a></h4>
<p>We have a git-tracked <a href="https://github.com/department-of-veterans-affairs/vets-api/tree/master/modules/mobile/docs/postman" target="_blank" rel="noopener noreferrer">Postman collection</a> containing both vets-api endpoints and an endpoint to our DevTools app that allows users to easily refresh your token. In Postman&#x27;s &quot;Local View&quot;, you can sync it to the vets-api folder <code>modules/mobile/docs/postman</code> and will reflect the state of the branch. Here you can make changes and even push changes if needed. Note that my experience has shown it to be a bit janky, so consider just importing the collections/environments or <code>push to cloud</code> (which pushes what&#x27;s on master/your branch to Postman)</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="automated-token-refresh-with-postman">Automated Token Refresh with Postman<a href="#automated-token-refresh-with-postman" class="hash-link" aria-label="Direct link to Automated Token Refresh with Postman" title="Direct link to Automated Token Refresh with Postman">​</a></h4>
<p>If you have authenticated a Test User within 30 days on your local vets-api instance, you can use the <code>Auth/Set Bearer Token</code> request/script in Postman to automatically refresh the <code>BEARER_TOKEN</code> Global variable, which is used in all requests as the Authorization/Bearer Token variable. If a refresh token expires, you will get a message suggesting <code>Manual login is required</code> and need to use DevTools to enter credentials before it can be auto-refreshed again.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authenticating-with-emulator-and-local-vets-api-changes">Authenticating with Emulator and local vets-api changes<a href="#authenticating-with-emulator-and-local-vets-api-changes" class="hash-link" aria-label="Direct link to Authenticating with Emulator and local vets-api changes" title="Direct link to Authenticating with Emulator and local vets-api changes">​</a></h3>
<p>TODO</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="upstream-connect">Upstream-Connect<a href="#upstream-connect" class="hash-link" aria-label="Direct link to Upstream-Connect" title="Direct link to Upstream-Connect">​</a></h2>
<p>The <code>upstream-connect</code> CLI tool/&quot;wizard&quot; is essentially a script in the vets-api repo that automates the steps for connecting a local vets-api isntance to the various upstream services&#x27; Staging environments. It does the following:</p>
<ul>
<li>Authenticates user with AWS CLI, to be used in the following steps</li>
<li>Accesses AWS parameter store to retrieve relevant staging secrets and adds them to your local settings</li>
<li>Provides information on any other manual steps required for the respective service you&#x27;re attempting to reach</li>
<li>Creates a &quot;tunnel&quot; that port-forwards from your localhost to the relevant upstream service via the staging fwd proxy</li>
<li>Allows for simple cleanup once you have completed your task</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="required-manual-configuration">Required Manual Configuration<a href="#required-manual-configuration" class="hash-link" aria-label="Direct link to Required Manual Configuration" title="Direct link to Required Manual Configuration">​</a></h3>
<p>Add the following snippet to <code>/config/initializers/faraday_middleware.rb</code></p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Faraday.default_connection_options = { ssl: { verify: false } }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On several endpoints you may run into certificate verification errors, and this allows our app to &quot;trust&quot; Postman (<strong>Remember to never commit this change!!!</strong>).</p>
<p>If you fail to do so, you will see something like the following in your response:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;title&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Internal server error&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;500&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;meta&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;exception&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SSL_connect returned=1 errno=0 peeraddr=127.0.0.1:4492 state=error: certificate verify failed (self-signed certificate)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-script">Using the Script<a href="#using-the-script" class="hash-link" aria-label="Direct link to Using the Script" title="Direct link to Using the Script">​</a></h3>
<p>From the root of the vets-api repo, run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ script/upstream-connect/upstream-connect.sh &lt;args&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Information on requirements, usage, and troubleshooting can be found in the <a href="https://github.com/department-of-veterans-affairs/vets-api/blob/main/script/upstream-connect/README-upstream-connect.md" target="_blank" rel="noopener noreferrer">README</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-requests-and-contributing">Feature Requests and Contributing<a href="#feature-requests-and-contributing" class="hash-link" aria-label="Direct link to Feature Requests and Contributing" title="Direct link to Feature Requests and Contributing">​</a></h2>
<p>If any upstream services have been omitted, or if new integrations are added in the future, please help us by bringing them to our attention and providing any information you have that may help us.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="open-an-issue">Open an issue<a href="#open-an-issue" class="hash-link" aria-label="Direct link to Open an issue" title="Direct link to Open an issue">​</a></h3>
<p>If you don&#x27;t know where to start or are unsure you have everything you need, please open an issue in the <a href="https://github.com/department-of-veterans-affairs/va-mobile-app" target="_blank" rel="noopener noreferrer">va-mobile-app repo</a>. Please include as much of the following as you can:</p>
<ul>
<li>Name of the upstream service and/or what the collection of endpoints may be referred to in discussion (e.g. We sometimes refer to the Caseflow API as &quot;Appeals&quot;, as that is where we go for Appeals data)</li>
<li>Relevant Mobile endpoints/controllers</li>
<li>Relevant vets-api services or anything else in the vets-api repo related to the integration</li>
<li>If the request is for an in-progress integration, link to any PRs where we might find information about the integration</li>
<li>Known test users with useful/relevant data.</li>
<li>Links to web pages that would contain va.gov&#x27;s version of the content being added (to compare test user data across modalities).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="contribute-to-upstream-connect">Contribute to Upstream-Connect<a href="#contribute-to-upstream-connect" class="hash-link" aria-label="Direct link to Contribute to Upstream-Connect" title="Direct link to Contribute to Upstream-Connect">​</a></h3>
<p>If you feel confident about all of the moving pieces of the integration, please open a <a href="https://github.com/department-of-veterans-affairs/vets-api" target="_blank" rel="noopener noreferrer">vets-api</a> PR with your additions to the <a href="https://github.com/department-of-veterans-affairs/vets-api/blob/master/script/upstream-connect/upstream_service_config.rb" target="_blank" rel="noopener noreferrer">upstream_service_config.rb</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="questions-and-troubleshooting">Questions and Troubleshooting<a href="#questions-and-troubleshooting" class="hash-link" aria-label="Direct link to Questions and Troubleshooting" title="Direct link to Questions and Troubleshooting">​</a></h2>
<p>If you have questions about anything above, please reach out to the #va-mobile-app-engineering in Slack</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/va-mobile-app/development/BackEnd/Testing/ApiTokens"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">API tokens</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/va-mobile-app/development/BackEnd/Testing/Postman"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Postman</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mobile-devtools--mobile-authentication" class="table-of-contents__link toc-highlight">Mobile DevTools / Mobile Authentication</a><ul><li><a href="#authenticating-with-postman-to-test-local-changes" class="table-of-contents__link toc-highlight">Authenticating with Postman to Test Local changes</a></li><li><a href="#authenticating-with-emulator-and-local-vets-api-changes" class="table-of-contents__link toc-highlight">Authenticating with Emulator and local vets-api changes</a></li></ul></li><li><a href="#upstream-connect" class="table-of-contents__link toc-highlight">Upstream-Connect</a><ul><li><a href="#required-manual-configuration" class="table-of-contents__link toc-highlight">Required Manual Configuration</a></li><li><a href="#using-the-script" class="table-of-contents__link toc-highlight">Using the Script</a></li></ul></li><li><a href="#feature-requests-and-contributing" class="table-of-contents__link toc-highlight">Feature Requests and Contributing</a><ul><li><a href="#open-an-issue" class="table-of-contents__link toc-highlight">Open an issue</a></li><li><a href="#contribute-to-upstream-connect" class="table-of-contents__link toc-highlight">Contribute to Upstream-Connect</a></li></ul></li><li><a href="#questions-and-troubleshooting" class="table-of-contents__link toc-highlight">Questions and Troubleshooting</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/va-mobile-app/img/va-blue-logo.png" alt="VA, United States Department of Veteran Affairs" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/va-mobile-app/img/va-blue-logo.png" alt="VA, United States Department of Veteran Affairs" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2025 VA Mobile App, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>